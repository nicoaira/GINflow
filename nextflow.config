/*
 nextflow.config - Default pipeline parameters
*/
params {
    // Input/output
    input                          = null
    outdir                         = 'results'
    header                         = true
    keep_cols                      = 'transcript_id'
    id_column                      = 'transcript_id'

    // Main workflow control
    subgraphs                      = true
    L                              = 30
    keep_paired_neighbors          = true
    structure_column_name          = 'secondary_structure'
    structure_column_num           = null
    mask_threshold                 = 0.3

    // Embedding generation
    num_workers                    = 4
    batch_size                     = 4096
    batch_size_embed               = 128
    // GPU usage flag
    use_gpu                        = false

    // FAISS index/query
    faiss_k                        = 1000
    query                          = null
    top_n                          = 10

    // Aggregation parameters
    alpha1                         = 0.25
    alpha2                         = 0.24
    beta1                          = 0.0057
    beta2                          = 1.15
    gamma                          = 0.41
    percentile                     = 1

    // Plotting
    plot_distances_distribution    = true
    hist_seed                      = 42
    hist_frac                      = 0.001
    hist_bins                      = 200
    plot_score_distribution        = true
    score_bins                     = 30
}


profiles {
    test {
        params {
            // Test input - small dataset
            input                      = "${baseDir}/tests/data/test_input.tsv"
            outdir                     = 'test_results'
            
            // Minimal settings for fast testing
            batch_size_embed           = 100   
            num_workers                = 2
            batch_size                 = 1000
            faiss_k                    = 1000
            top_n                      = 5
            
            // Use first transcript as query for testing
            query                      = 'ENST00000832823.1'
            
            // Disable some plots for faster testing
            plot_distances_distribution = true
            plot_score_distribution    = true
        }
        
    }
    conda {
        conda.enabled           = true
        docker.enabled          = false
        singularity.enabled     = false
        conda.channels          = ['conda-forge', 'bioconda']
    }
    mamba {
        conda.enabled           = true
        conda.useMamba          = true
        docker.enabled          = false
        singularity.enabled     = false
    }
    docker {
        docker.enabled          = true
        conda.enabled           = false
        singularity.enabled     = false
        docker.runOptions       = params.use_gpu ? '--gpus all' : '-u $(id -u):$(id -g)'
    }
    singularity {
        singularity.enabled     = true
        singularity.autoMounts  = true
        conda.enabled           = false
        docker.enabled          = false
    }
}

//report
// define a timestamp and reports directory
/*
trace {
  enabled = true
  file    = "${reportsDir}/trace.tsv"
}

report {
  enabled = true
  file    = "${reportsDir}/report.html"
}

timeline {
  enabled = true
  file    = "${reportsDir}/timeline.html"
}

dag {
  enabled = true
  file    = "${reportsDir}/flowchart.png"
}
*/

manifest {
  name = 'GINflow'
  version = '0.1.0'
  mainScript = 'workflows/main.nf'
}
